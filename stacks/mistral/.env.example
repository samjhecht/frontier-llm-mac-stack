# Mistral Stack Environment Configuration
# Copy this file to .env and adjust values as needed

# Mistral Configuration
MISTRAL_MODELS_PATH=./data/mistral-models
MISTRAL_HOST=0.0.0.0
MISTRAL_PORT=8080
MISTRAL_MODEL_PATH=/models

# Default Model (Mistral format)
DEFAULT_MODEL=mistral-7b-instruct

# Resource Limits (adjust based on your Mac Studio specs)
MISTRAL_MEMORY_LIMIT=64G
MISTRAL_MEMORY_RESERVATION=32G

# Network Configuration

# Development Mode
ENABLE_GPU_MONITORING=false

# Metal/GPU Acceleration
ENABLE_METAL=true
ENABLE_CUDA=false

# Build Configuration
CUDA_VERSION=12.2.0
MISTRAL_RS_VERSION=v0.6.0

# Runtime Configuration
MISTRAL_LOG_LEVEL=info
MISTRAL_MAX_BATCH_SIZE=8

# Health Check Configuration
MISTRAL_HEALTH_INTERVAL=30s
MISTRAL_HEALTH_TIMEOUT=10s
MISTRAL_HEALTH_RETRIES=3
MISTRAL_HEALTH_START_PERIOD=60s

# Logging Configuration
MISTRAL_LOG_MAX_SIZE=10m
MISTRAL_LOG_MAX_FILE=3

# Metal Acceleration Settings
MISTRAL_DEVICE=metal
MISTRAL_METAL_DEVICE_ID=0
MISTRAL_USE_FLASH_ATTENTION=true
MISTRAL_METAL_HEAP_SIZE=68719476736  # 64GB for Mac Studio Ultra
MISTRAL_METAL_COMMAND_BUFFER_SIZE=1073741824  # 1GB

# Memory Management
MISTRAL_MAX_SEQ_LEN=32768
MISTRAL_MEMORY_FRACTION=0.9
MISTRAL_KV_CACHE_DTYPE=f16
MISTRAL_ENABLE_MEMORY_POOLING=true
MISTRAL_MEMORY_POOL_SIZE=8589934592  # 8GB pool

# Performance Tuning
MISTRAL_NUM_THREADS=0  # 0 = auto-detect
MISTRAL_TENSOR_PARALLEL_SIZE=1
MISTRAL_PIPELINE_PARALLEL_SIZE=1
MISTRAL_USE_GRAPH_CAPTURE=true
MISTRAL_PREFILL_CHUNK_SIZE=2048
MISTRAL_DECODE_CHUNK_SIZE=256

# Quantization Settings
MISTRAL_DEFAULT_QUANTIZATION=q5_k_m
MISTRAL_DYNAMIC_QUANTIZATION=true
MISTRAL_QUANTIZATION_CACHE_SIZE=1073741824  # 1GB

# Inference Optimization
MISTRAL_ENABLE_CONTINUOUS_BATCHING=true
MISTRAL_MAX_RUNNING_REQUESTS=16
MISTRAL_MAX_TOTAL_TOKENS=131072
MISTRAL_ENABLE_PREFIX_CACHING=true
MISTRAL_PREFIX_CACHE_SIZE=2147483648  # 2GB

# Metal-specific Optimizations
MISTRAL_METAL_SHADER_VARIANT=optimized
MISTRAL_METAL_SIMD_REDUCTION=true
MISTRAL_METAL_ASYNC_DISPATCH=true
MISTRAL_METAL_COMMAND_QUEUE_SIZE=64